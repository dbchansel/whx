<%@ Page Language="C#" AutoEventWireup="true" Inherits="DTcms.Web.UI.Page.VoteIndex" ValidateRequest="false" %>
<%@ Import namespace="System.Collections.Generic" %>
<%@ Import namespace="System.Text" %>
<%@ Import namespace="System.Data" %>
<%@ Import namespace="DTcms.Common" %>

<script runat="server">
override protected void OnInit(EventArgs e)
{

	/* 
		This page was created by DTcms Template Engine at 2020/4/6 20:16:34.
		本页面代码由DTcms模板引擎生成于 2020/4/6 20:16:34. 
	*/

	base.OnInit(e);
	StringBuilder templateBuilder = new StringBuilder(220000);

	templateBuilder.Append("<!DOCTYPE html>\r\n<!--HTML5 doctype-->\r\n<html>\r\n<head>\r\n    <meta charset=\"utf-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width,initial-scale=1,user-scalable=0\">\r\n    <title>投票啦 - ");
	templateBuilder.Append(Utils.ObjectToStr(model.Activity_Title));
	templateBuilder.Append("</title>\r\n    <meta name=\"keywords\" content=\"");
	templateBuilder.Append(Utils.ObjectToStr(site.seo_keyword));
	templateBuilder.Append("\" />\r\n    <meta name=\"description\" content=\"");
	templateBuilder.Append(Utils.ObjectToStr(site.seo_description));
	templateBuilder.Append("\" />\r\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"");
	templateBuilder.Append("/templates/mobile");
	templateBuilder.Append("/css/idangerous.swiper.css\" />\r\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"");
	templateBuilder.Append("/templates/mobile");
	templateBuilder.Append("/css/style.css\" />\r\n    <script type=\"text/javascript\" charset=\"utf-8\" src=\"");
	templateBuilder.Append("/templates/mobile");
	templateBuilder.Append("/js/zepto.min.js\"></");
	templateBuilder.Append("script>\r\n    <script type=\"text/javascript\" charset=\"utf-8\" src=\"");
	templateBuilder.Append("/templates/mobile");
	templateBuilder.Append("/js/weui.min.js\"></");
	templateBuilder.Append("script>\r\n    <script type=\"text/javascript\" charset=\"utf-8\" src=\"");
	templateBuilder.Append("/templates/mobile");
	templateBuilder.Append("/js/common.js\"></");
	templateBuilder.Append("script>\r\n    <script type=\"text/javascript\" charset=\"utf-8\" src=\"");
	templateBuilder.Append("/templates/mobile");
	templateBuilder.Append("/js/idangerous.swiper-2.1.min.js\"></");
	templateBuilder.Append("script>\r\n\r\n    <link rel=\"stylesheet\" href=\"https://cdn.bootcss.com/weui/1.1.3/style/weui.min.css\">\r\n    <link rel=\"stylesheet\" href=\"https://cdn.bootcss.com/jquery-weui/1.2.1/css/jquery-weui.min.css\">\r\n\r\n    <script src=\"https://cdn.bootcss.com/jquery/1.11.0/jquery.min.js\"></");
	templateBuilder.Append("script>\r\n    <script src=\"https://cdn.bootcss.com/jquery-weui/1.2.1/js/jquery-weui.min.js\"></");
	templateBuilder.Append("script>\r\n\r\n    <!-- 如果使用了某些拓展插件还需要额外的JS -->\r\n    <script src=\"https://cdn.bootcss.com/jquery-weui/1.2.1/js/swiper.min.js\"></");
	templateBuilder.Append("script>\r\n    <script src=\"https://cdn.bootcss.com/jquery-weui/1.2.1/js/city-picker.min.js\"></");
	templateBuilder.Append("script>\r\n    <link rel=\"stylesheet\" href=\"https://res.wx.qq.com/open/libs/weui/0.3.0/weui.css\" />\r\n    <script type=\"text/javascript\">\r\n        var JoinImg1 = \"\";\r\n        var JoinImg2 = \"\";\r\n        var JoinImg3 = \"\";\r\n        var JoinImg4 = \"\";\r\n        var JoinImg5 = \"\";\r\n        var JoinImg6 = \"\";\r\n        var JoinImg7 = \"\";\r\n        var JoinImg8 = \"\";\r\n        var JoinImg9 = \"\";\r\n        var JoinImg10 = \"\";\r\n        var openid;\r\n        function getCookie(c_name) {\r\n            if (document.cookie.length > 0) {\r\n                c_start = document.cookie.indexOf(c_name + \"=\")\r\n                if (c_start != -1) {\r\n                    c_start = c_start + c_name.length + 1\r\n                    c_end = document.cookie.indexOf(\";\", c_start)\r\n                    if (c_end == -1) c_end = document.cookie.length\r\n                    return unescape(document.cookie.substring(c_start, c_end))\r\n                }\r\n            }\r\n            return \"\"\r\n        }\r\n        $(function () {\r\n            openid = getCookie(\"openid\");\r\n            if (openid == null && openid == \"\")\r\n            {\r\n    //            alert(\"goVote.aspx?id=");
	templateBuilder.Append(Utils.ObjectToStr(model.id));
	templateBuilder.Append("\");\r\n                window.location.href = \"goVote.aspx?id=");
	templateBuilder.Append(Utils.ObjectToStr(model.id));
	templateBuilder.Append("\";\r\n            }\r\n            // 允许上传的图片类型\r\n            var allowTypes = ['image/jpg', 'image/jpeg', 'image/png', 'image/gif'];\r\n            // 1024KB，也就是 1MB\r\n            var maxSize = 4024 * 4024;\r\n            // 图片最大宽度\r\n            var maxWidth = 300;\r\n            // 最大上传图片数量\r\n            var maxCount = 10;\r\n            $('.js_file').on('change', function (event) {\r\n                var files = event.target.files;\r\n\r\n                // 如果没有选中文件，直接返回\r\n                if (files.length === 0) {\r\n                    return;\r\n                }\r\n\r\n                for (var i = 0, len = files.length; i < len; i++) {\r\n                    var file = files[i];\r\n                    var reader = new FileReader();\r\n\r\n                    // 如果类型不在允许的类型范围内\r\n                    if (allowTypes.indexOf(file.type) === -1) {\r\n                        $.weui.alert({ text: '该类型不允许上传' });\r\n                        continue;\r\n                    }\r\n\r\n                    if (file.size > maxSize) {\r\n                        $.weui.alert({ text: '图片太大，不允许上传' });\r\n                        continue;\r\n                    }\r\n\r\n                    if ($('.weui_uploader_file').length >= maxCount) {\r\n                        $.weui.alert({ text: '最多只能上传' + maxCount + '张图片' });\r\n                        return;\r\n                    }\r\n\r\n                    reader.onload = function (e) {\r\n                        var img = new Image();\r\n                        img.onload = function () {\r\n                            // 不要超出最大宽度\r\n                            var w = Math.min(maxWidth, img.width);\r\n                            // 高度按比例计算\r\n                            var h = img.height * (w / img.width);\r\n                            var canvas = document.createElement('canvas');\r\n                            var ctx = canvas.getContext('2d');\r\n                            // 设置 canvas 的宽度和高度\r\n                            canvas.width = w;\r\n                            canvas.height = h;\r\n                            ctx.drawImage(img, 0, 0, w, h);\r\n                            var base64 = canvas.toDataURL();\r\n\r\n                            // 插入到预览区\r\n                            var $preview = $('<li class=\"weui_uploader_file weui_uploader_status\" style=\"background-image:url(' + base64 + ')\"><div class=\"weui_uploader_status_content\">0%</div></li>');\r\n                            $('.weui_uploader_files').append($preview);\r\n                            var num = $('.weui_uploader_file').length;\r\n                            if (num == 1)\r\n                                JoinImg1 = base64.split(';')[1].split(',')[1];\r\n                            if (num == 2)\r\n                                JoinImg2 = base64.split(';')[1].split(',')[1];\r\n                            if (num == 3)\r\n                                JoinImg3 = base64.split(';')[1].split(',')[1];\r\n                            if (num == 4)\r\n                                JoinImg4 = base64.split(';')[1].split(',')[1];\r\n                            if (num == 5)\r\n                                JoinImg5 = base64.split(';')[1].split(',')[1];\r\n                            if (num == 6)\r\n                                JoinImg6 = base64.split(';')[1].split(',')[1];\r\n                            if (num == 7)\r\n                                JoinImg7 = base64.split(';')[1].split(',')[1];\r\n                            if (num == 8)\r\n                                JoinImg8 = base64.split(';')[1].split(',')[1];\r\n                            if (num == 9)\r\n                                JoinImg9 = base64.split(';')[1].split(',')[1];\r\n                            if (num == 10)\r\n                                JoinImg10 = base64.split(';')[1].split(',')[1];\r\n\r\n                            $('.js_counter').text(num + '/' + maxCount);\r\n\r\n                            // 然后假装在上传，可以post base64格式，也可以构造blob对象上传，也可以用微信JSSDK上传\r\n\r\n                            var progress = 0;\r\n                            function uploading() {\r\n                                $preview.find('.weui_uploader_status_content').text(++progress + '%');\r\n                                if (progress < 100) {\r\n                                    setTimeout(uploading, 30);\r\n                                }\r\n                                else {\r\n                                    // 如果是失败，塞一个失败图标\r\n                                    //$preview.find('.weui_uploader_status_content').html('<i class=\"weui_icon_warn\"></i>');\r\n                                    $preview.removeClass('weui_uploader_status').find('.weui_uploader_status_content').remove();\r\n                                }\r\n                            }\r\n                            setTimeout(uploading, 30);\r\n                        };\r\n\r\n                        img.src = e.target.result;        \r\n                    };\r\n                    reader.readAsDataURL(file);\r\n                }\r\n            });\r\n        });\r\n\r\n	$(document).ready(function(){\r\n		var mySwiper = new Swiper('.swiper-container',{\r\n			calculateHeight:true,\r\n			resizeReInit:true,\r\n			pagination:\".pagination\",\r\n			autoplay:5000,\r\n			paginationClickable:true\r\n		});\r\n	});\r\n	function JoinFun()\r\n	{\r\n	    var JoinContent = $(\"#JoinContent\").val();\r\n	    var JoinAddress = $(\"#JoinAddress\").val();\r\n	    var JoinTel = $(\"#JoinTel\").val();\r\n	    var JoinName = $(\"#JoinName\").val();\r\n	    var aj = $.ajax({\r\n	        url: '");
	templateBuilder.Append(Utils.ObjectToStr(config.webpath));
	templateBuilder.Append("tools/submit_ajax.ashx?action=VoteJoin&id=");
	templateBuilder.Append(Utils.ObjectToStr(model.id));
	templateBuilder.Append("',// 投票\r\n	        type: 'post',\r\n	        data: {\r\n	            'action': 'VoteJoin',\r\n	            'id': '");
	templateBuilder.Append(Utils.ObjectToStr(model.id));
	templateBuilder.Append("',\r\n	            'JoinContent': JoinContent,\r\n	            'JoinAddress': JoinAddress,\r\n	            'JoinTel': JoinTel,\r\n	            'JoinName': JoinName,\r\n	            'JoinImg1': JoinImg1,\r\n	            'JoinImg2': JoinImg2,\r\n	            'JoinImg3': JoinImg3,\r\n	            'JoinImg4': JoinImg4,\r\n	            'JoinImg5': JoinImg5,\r\n	            'JoinImg6': JoinImg6,\r\n	            'JoinImg7': JoinImg7,\r\n	            'JoinImg8': JoinImg8,\r\n	            'JoinImg9': JoinImg9,\r\n	            'JoinImg10': JoinImg10,\r\n	            'openid': openid\r\n	        },\r\n	        cache: false,\r\n	        dataType: 'json',\r\n	        success: function (data) {\r\n	            if (data.status == \"1\") {\r\n	                alert(\"报名成功，等待管理员审核！\");\r\n	                var t = setTimeout(\"reloadVotemember()\", 1000);\r\n	         //       openSucced();\r\n	                //  window.location.href = \"");
	templateBuilder.Append(Utils.ObjectToStr(config.webpath));
	templateBuilder.Append("api/payment/wxapipay/index_vote.aspx?pay_order_no=\" + data.order_no + \"&pay_order_amount=\" + data.order_amount;\r\n	            } else {\r\n	                debugger;\r\n	                alert(\"异常！\");\r\n	            }\r\n	        },\r\n	        error: function () {\r\n	            // view(\"异常！\");    \r\n	            alert(\"异常！\");\r\n	        }\r\n	    });\r\n	//    alert('");
	templateBuilder.Append(Utils.ObjectToStr(config.webpath));
	templateBuilder.Append("tools/submit_ajax.ashx?action=VoteJoin&id=");
	templateBuilder.Append(Utils.ObjectToStr(id));
	templateBuilder.Append("&JoinContent=' + JoinContent + '&JoinImg1=' + JoinImg1 + '&JoinAddress=' + JoinAddress + '&JoinTel=' + JoinTel + '&JoinName=' + JoinName + '&VoteId=");
	templateBuilder.Append(Utils.ObjectToStr(id));
	templateBuilder.Append("');\r\n	//    clickSubmit('");
	templateBuilder.Append(Utils.ObjectToStr(config.webpath));
	templateBuilder.Append("tools/submit_ajax.ashx?action=VoteJoin&id=");
	templateBuilder.Append(Utils.ObjectToStr(id));
	templateBuilder.Append("&JoinContent=' + JoinContent + '&JoinImg1=' + JoinImg1 + '&JoinAddress=' + JoinAddress + '&JoinTel=' + JoinTel + '&JoinName=' + JoinName + '&VoteId=");
	templateBuilder.Append(Utils.ObjectToStr(id));
	templateBuilder.Append("');\r\n	}\r\n	function reloadVotemember() {\r\n	    window.location.href = \"goVote.aspx?id=");
	templateBuilder.Append(Utils.ObjectToStr(model.id));
	templateBuilder.Append("\";\r\n	}\r\n        //图片上传，参考文档https://blog.csdn.net/sinat_36558867/article/details/79492843\r\n    </");
	templateBuilder.Append("script>\r\n</head>\r\n\r\n<body style=\"background-color:#ffffff\" id=\"news\" ontouchstart>\r\n    <div class=\"page\">\r\n        <!--页面头部-->\r\n        <div class=\"header\">\r\n            <h3>填写报名信息</h3>\r\n        </div>\r\n        <!--/页面头部-->\r\n        <!--页面内容-->\r\n        <div class=\"page__bd\">\r\n            <!--注册信息-->\r\n            <div class=\"weui-cells__title\">选手姓名：</div>\r\n            <div class=\"weui-cells\">\r\n                <div class=\"weui-cell\">\r\n                    <div class=\"weui-cell__bd\">\r\n                        <input class=\"weui-input\" id=\"JoinName\" type=\"text\" placeholder=\"请输入选手姓名\">\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class=\"weui-cells__title\">联络方式</div>\r\n            <div class=\"weui-cells\">\r\n                <div class=\"weui-cell\">\r\n                    <div class=\"weui-cell__bd\">\r\n                        <input class=\"weui-input\" id=\"JoinTel\" type=\"text\" placeholder=\"请输入联络方式\">\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class=\"weui-cells__title\">选手地址</div>\r\n            <div class=\"weui-cells\">\r\n                <div class=\"weui-cell\">\r\n                    <div class=\"weui-cell__bd\">\r\n                        <input class=\"weui-input\" id=\"JoinAddress\" type=\"text\" placeholder=\"请输入选手地址\">\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class=\"weui-cells__title\">选手介绍：</div>\r\n            <div class=\"weui-cells weui-cells_form\">\r\n                <div class=\"weui-cell\">\r\n                    <div class=\"weui-cell__bd\">\r\n                        <textarea class=\"weui-textarea\" id=\"JoinContent\" placeholder=\"请输入选手介绍\" rows=\"3\"></textarea>\r\n                        <div class=\"weui-textarea-counter\"><span>0</span>/500</div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class=\"weui-panel_access\">\r\n                <div class=\"weui_uploader\">\r\n                    <div class=\"weui_uploader_hd weui_cell\">\r\n                        <div class=\"weui_cell_bd weui_cell_primary\">图片上传</div>\r\n                        <div class=\"weui_cell_ft js_counter\">0/10</div>\r\n                    </div>\r\n                    <div class=\"weui_uploader_bd\">\r\n                        <ul class=\"weui_uploader_files\" id=\"imgli\">\r\n                            <!-- 预览图插入到这 -->\r\n                        </ul>\r\n                        <div class=\"weui_uploader_input_wrp\">\r\n                            <input class=\"weui_uploader_input js_file\" type=\"file\" accept=\"image/jpg,image/jpeg,image/png,image/gif\" multiple=\"\">\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n\r\n                <center>\r\n                    <div style=\"width:250px;height:35px;background-color:limegreen;text-align:center;color:white;font-size:20px;border-radius: 6px;\" onclick=\"JoinFun()\">\r\n                        确认参加\r\n                    </div>\r\n                </center>\r\n            </div>\r\n            <!--注册信息-->\r\n            <!--版权信息-->\r\n            ");

	templateBuilder.Append("<div class=\"weui-footer footer\">\r\n    <p class=\"weui-footer__text\">");
	templateBuilder.Append(Utils.ObjectToStr(site.copyright));
	templateBuilder.Append("</p>\r\n</div>");


	templateBuilder.Append("\r\n            <!--/版权信息-->\r\n            <!--底部导航-->\r\n            <div class=\"weui-tab foot-nav\">\r\n                <div class=\"weui-tab__panel\">\r\n\r\n                </div>\r\n                <div class=\"weui-tabbar\">\r\n                    <a href=\"goVote.aspx?id=");
	templateBuilder.Append(Utils.ObjectToStr(model.id));
	templateBuilder.Append("\" class=\"weui-tabbar__item\">\r\n                        <i class=\"iconfont icon-home weui-tabbar__icon\"></i>\r\n                        <p class=\"weui-tabbar__label\">首页</p>\r\n                    </a>\r\n                    <a href=\"VoteRank.aspx?VoteId=");
	templateBuilder.Append(Utils.ObjectToStr(model.id));
	templateBuilder.Append("\" class=\"weui-tabbar__item\">\r\n                        <i class=\"iconfont icon-view weui-tabbar__icon\"></i>\r\n                        <p class=\"weui-tabbar__label\">排名</p>\r\n                    </a>\r\n                    <a href=\"VoteGift.aspx?VoteId=");
	templateBuilder.Append(Utils.ObjectToStr(model.id));
	templateBuilder.Append("\" class=\"weui-tabbar__item\">\r\n                        <i class=\"iconfont icon-order weui-tabbar__icon\"></i>\r\n                        <p class=\"weui-tabbar__label\">奖品</p>\r\n                    </a>\r\n                    <a href=\"VoteJoin.aspx?VoteId=");
	templateBuilder.Append(Utils.ObjectToStr(model.id));
	templateBuilder.Append("\" class=\"weui-tabbar__item\">\r\n                        <i class=\"iconfont icon-user weui-tabbar__icon\"></i>\r\n                        <p class=\"weui-tabbar__label\">报名</p>\r\n                    </a>\r\n                </div>\r\n            </div>\r\n            <!--/底部导航-->\r\n        </div>\r\n        <!--/页面内容-->\r\n    </div>\r\n</body>\r\n</html>\r\n");
	Response.Write(templateBuilder.ToString());
}
</script>
